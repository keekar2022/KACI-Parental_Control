{
  "build_info": {
    "version": "1.4.20",
    "build_date": "2026-01-07T13:00:00Z",
    "git_commit": "pending",
    "git_branch": "develop",
    "built_by": "development",
    "build_environment": "local"
  },
  "runtime_info": {
    "php_version_required": "8.1+",
    "pfsense_version_required": "2.7.0+",
    "freebsd_version_required": "13.0+"
  },
  "dependencies": {
    "required": [
      {
        "name": "sudo",
        "package": "security/sudo",
        "version": "1.9.16p2+",
        "description": "Allows delegation of privileges for shell commands",
        "auto_install": true
      },
      {
        "name": "cron",
        "package": "sysutils/cron",
        "version": "0.3.8_6+",
        "description": "Manages scheduled tasks for usage tracking",
        "auto_install": false,
        "note": "Usually part of FreeBSD base system"
      }
    ]
  },
  "package_info": {
    "name": "KACI-Parental_Control",
    "full_name": "Keekar's Parental Control",
    "author": "Mukesh Kesharwani",
    "license": "Apache-2.0",
    "repository": "https://github.com/keekar2022/KACI-Parental_Control"
  },
  "features": [
    "Profile-based device grouping",
    "Shared time accounting (bypass-proof)",
    "Weekend bonus time",
    "Flexible scheduling (bedtime, school hours, custom)",
    "DHCP/ARP auto-discovery",
    "OpenTelemetry logging",
    "Automatic log rotation",
    "Real-time status dashboard",
    "Health check endpoint",
    "Multiple enforcement modes",
    "RESTful API for external integration",
    "Performance caching (DHCP, config, state)",
    "DRY helper functions for maintainability"
  ],
  "files": {
    "core": [
      "parental_control.inc",
      "parental_control.xml",
      "parental_control_profiles.xml",
      "parental_control_status.php",
      "parental_control_health.php",
      "parental_control_api.php",
      "info.xml"
    ],
    "documentation": [
      "README.md",
      "QUICKSTART.md",
      "BEST_PRACTICES-KACI-ParentalControl.md",
      "RECOMMENDATIONS_FOR_ADOPTION.md",
      "VERSION",
      "docs/API.md",
      "docs/CONFIGURATION.md",
      "docs/TROUBLESHOOTING.md"
    ],
    "installation": [
      "INSTALL.sh"
    ]
  },
  "deployment": {
    "install_paths": {
      "core_logic": "/usr/local/pkg/",
      "web_files": "/usr/local/www/",
      "metadata": "/usr/local/share/pfSense-pkg-KACI-Parental_Control/",
      "logs": "/var/log/",
      "state": "/var/db/",
      "config": "/cf/conf/"
    }
  },
  "changelog": [
    {
      "version": "1.4.20",
      "date": "2026-01-07",
      "type": "critical_bugfix",
      "changes": [
        "CRITICAL BUGFIX: Fixed monitored devices showing 'Unknown Device' and 'Unknown' profile",
        "BUG: Monitored devices panel displayed all devices as 'Unknown Device' with 'Unknown' profile",
        "BUG: Device names and profile assignments were not showing despite being available",
        "USER REPORT: 'If Device name and Profile details are available in blocked why it is unknown in monitor?'",
        "ROOT CAUSE: Monitored devices lookup logic only checked $state['devices'][$mac]",
        "ROOT CAUSE: Device names and profiles are stored in profile configuration (config.xml), not state file",
        "ROOT CAUSE: Blocked devices section works because it looks at $state['blocked_devices'][$mac]",
        "COMPARISON:",
        "  - Blocked devices âœ“: Looks at blocked_devices array with full device details",
        "  - Monitored devices âœ—: Only looked at devices array with limited info",
        "  - Main status table âœ“: Iterates through profile configuration to get device names",
        "SOLUTION: Updated monitored devices lookup to search through ALL profiles",
        "SOLUTION: Matches the logic used in 'Profile & Device Status' section (lines 140-250)",
        "SOLUTION: Search profiles â†’ find device by MAC â†’ extract device_name and profile_name",
        "SOLUTION: Added fallback to state file if device not found in profiles",
        "RESULT: Monitored devices now show correct device names (e.g., 'Basement-TV', 'HISENSETV')",
        "RESULT: Monitored devices now show correct profile names (e.g., 'GunGun', 'Anita', 'Vishesh')",
        "RESULT: Information consistency between blocked and monitored device panels",
        "RESULT: Users can now properly identify which devices are being monitored",
        "TECHNICAL CHANGES:",
        "  - Added profile iteration loop to search for device by MAC address",
        "  - Extract device_name from profile configuration: $device['device_name']",
        "  - Extract profile_name from profile: $profile['name']",
        "  - Maintained state file fallback for edge cases",
        "  - Uses break 2 to exit nested loops when device found",
        "BENEFIT: Complete visibility and accurate device identification",
        "TESTING: Verified with production data showing 10 monitored devices with correct names",
        "VERSION: 1.4.19 â†’ 1.4.20"
      ]
    },
    {
      "version": "1.4.19",
      "date": "2026-01-07",
      "type": "feature",
      "changes": [
        "FEATURE: Added monitored devices display panel to status page",
        "NEW PANEL: 'Monitored Devices (pfSense Table)' shows all devices in parental_control_monitor alias",
        "DISPLAY: Table shows IP address, device name, MAC address, profile, and online status",
        "VISUALIZATION: Color-coded status badges (green for Online, gray for Offline)",
        "INFORMATION: Displays device count and monitoring status",
        "INTEGRATION: Uses pfctl -t parental_control_monitor -T show to fetch monitored IPs",
        "CONSISTENCY: Matches the existing blocked devices panel format",
        "EXPLANATION: Includes helpful info box explaining how device monitoring works",
        "PURPOSE: Provides visibility into which devices are actively being tracked for usage",
        "CLI COMMAND: Shows command to manually check monitored devices (pfctl -t parental_control_monitor -T show)",
        "USER BENEFIT: Complete visibility into both blocked and monitored device states",
        "VERSION: 1.4.18 â†’ 1.4.19"
      ]
    },
    {
      "version": "1.4.18",
      "date": "2026-01-06",
      "type": "emergency_hotfix",
      "severity": "CRITICAL",
      "changes": [
        "ðŸš¨ EMERGENCY HOTFIX: Kernel Panic Prevention - Test firewall had to be completely rebuilt",
        "SEVERITY: CRITICAL - v1.4.11-1.4.17 contain bugs that can cause system-level crashes",
        "DO NOT DEPLOY v1.4.11-1.4.17 to ANY system - immediate upgrade to v1.4.18 required",
        "",
        "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
        "ROOT CAUSES OF KERNEL PANIC:",
        "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
        "1. FILE DESCRIPTOR LEAKS in PID locking mechanism",
        "   - PID lock opens file, stores in global variable",
        "   - If exception thrown, file handle NEVER closed",
        "   - Accumulates over time â†’ resource exhaustion â†’ kernel panic",
        "",
        "2. NO STALE LOCK CLEANUP - deadlock scenario",
        "   - If process crashes while holding lock, lock NEVER released",
        "   - All future cron jobs blocked forever",
        "   - System deadlock",
        "",
        "3. NO EXECUTION TIMEOUT - infinite loop risk",
        "   - Cron job can run indefinitely if stuck",
        "   - Multiple overlapping instances possible",
        "   - CPU/memory exhaustion",
        "",
        "4. TOO FREQUENT CRON - overlap risk",
        "   - */5 (every 5 min) = 288 executions/day",
        "   - High risk of overlap and resource contention",
        "   - Excessive system load",
        "",
        "5. UNSAFE pfctl OPERATIONS - kernel-level risk",
        "   - Direct pfctl commands without validation",
        "   - No timeout protection",
        "   - Could trigger FreeBSD kernel bugs",
        "",
        "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
        "EMERGENCY FIXES IMPLEMENTED:",
        "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
        "",
        "FIX #1: Stale Lock Detection & Cleanup",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
        "- Detects locks older than 10 minutes (stuck processes)",
        "- Forces cleanup of stale locks automatically",
        "- Kills stuck processes before taking lock",
        "- Prevents permanent deadlocks",
        "CODE: pc_acquire_pid_lock() - Added stale lock detection",
        "",
        "FIX #2: Guaranteed File Descriptor Cleanup",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
        "- Added try/finally blocks around ALL file operations",
        "- Ensures fclose() ALWAYS called, even on exception",
        "- Track acquisition state with $pc_pid_lock_acquired flag",
        "- Prevents resource leaks completely",
        "CODE: pc_acquire_pid_lock() - Added try/finally wrapper",
        "CODE: pc_release_pid_lock() - Only release if actually acquired",
        "",
        "FIX #3: Execution Timeout & Watchdog",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
        "- Set max_execution_time to 60 seconds",
        "- Added watchdog timer (55 second warning)",
        "- Auto-kill if execution exceeds limit",
        "- Prevents infinite loops",
        "CODE: parental_control_cron_job() - Added set_time_limit(60)",
        "CODE: parental_control_cron_job() - Added register_tick_function watchdog",
        "",
        "FIX #4: Reduced Cron Frequency",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
        "- Changed from */5 to */10 (10 minutes)",
        "- Reduces daily executions from 288 to 144 (50% reduction)",
        "- Much lower risk of overlap",
        "- Trade-off: Slightly less responsive (10 min vs 5 min)",
        "- BENEFIT: Much more stable system",
        "CODE: PC_CRON_MINUTE - Changed from '*/5' to '*/10'",
        "CODE: PC_CRON_INTERVAL_SECONDS - Changed from 300 to 600",
        "",
        "FIX #5: Safe pfctl Wrapper",
        "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",
        "- NEW FUNCTION: pc_safe_pfctl() - Wrapper for all pfctl operations",
        "- Validates command syntax (prevents injection)",
        "- Adds timeout (5 seconds default, max 30)",
        "- Logs all executions for debugging",
        "- Catches and logs errors gracefully",
        "- Detects timeout conditions (exit code 124)",
        "CODE: pc_safe_pfctl() - New safety wrapper function",
        "",
        "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
        "FILES MODIFIED:",
        "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
        "- parental_control.inc:",
        "  * pc_acquire_pid_lock() - 70 lines rewritten",
        "  * pc_release_pid_lock() - Added acquisition state check",
        "  * parental_control_cron_job() - Added timeout & watchdog",
        "  * pc_safe_pfctl() - NEW FUNCTION (80 lines)",
        "  * PC_CRON_MINUTE - Changed to '*/10'",
        "  * PC_CRON_INTERVAL_SECONDS - Changed to 600",
        "",
        "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
        "DEPLOYMENT NOTES:",
        "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
        "âš ï¸  CRITICAL: Do NOT deploy v1.4.11-1.4.17 to ANY system",
        "âœ… Deploy v1.4.18 to production (192.168.1.1) FIRST",
        "âœ… Monitor for 24 hours before deploying to test",
        "âœ… Rollback plan: v1.4.9 is safe fallback",
        "",
        "WHAT CAUSED THE PANIC:",
        "- Test firewall (192.168.1.251) entered kernel panic (db> prompt)",
        "- System completely unresponsive, had to be rebuilt from scratch",
        "- Root cause: File descriptor leak + cron overlap + resource exhaustion",
        "",
        "IMPACT:",
        "- BEFORE: System unstable, risk of kernel panic",
        "- AFTER: All critical bugs fixed, system stable",
        "",
        "VERSION: 1.4.17 â†’ 1.4.18 (EMERGENCY RELEASE)"
      ]
    },
    {
      "version": "1.4.17",
      "date": "2026-01-06",
      "type": "critical_fix",
      "changes": [
        "CRITICAL FIX: State file initialization now sets last_reset to today's midnight instead of current time",
        "BUG: New installations initialized last_reset to current time (e.g., 09:13 AM)",
        "BUG: System would wait until next day's midnight before performing first reset",
        "BUG: Time limits wouldn't reset until 24+ hours after installation",
        "USER REPORT: 'Time counters not resetting at midnight'",
        "ROOT CAUSE: pc_init_state() set last_reset = time() (current timestamp)",
        "ROOT CAUSE: New profiles set last_reset = time() when created",
        "ROOT CAUSE: State file created at 9:13 AM would wait until tomorrow at midnight",
        "ROOT CAUSE: Profiles created mid-day wouldn't reset until next day",
        "PROBLEM: Misalignment between installation time and reset boundary",
        "PROBLEM: First reset delayed by up to 24 hours",
        "PROBLEM: Inconsistent behavior for new installations",
        "SOLUTION: Created pc_get_today_midnight() helper function",
        "SOLUTION: Returns strtotime('today 00:00:00') for proper alignment",
        "SOLUTION: Updated pc_init_state() to use midnight timestamp",
        "SOLUTION: Updated pc_load_state() error handler to use midnight timestamp",
        "SOLUTION: Updated profile initialization (3 locations) to use midnight timestamp",
        "RESULT: New installations immediately aligned to daily reset schedule",
        "RESULT: State file created at any time uses today's midnight as baseline",
        "RESULT: First reset happens at the configured time (not 24 hours later)",
        "RESULT: Profiles created mid-day reset at next midnight (tonight, not tomorrow)",
        "RESULT: Consistent behavior regardless of installation/creation time",
        "TECHNICAL CHANGES:",
        "  - NEW FUNCTION: pc_get_today_midnight() - returns today's 00:00:00 timestamp",
        "  - UPDATED: pc_init_state() - line 977 uses pc_get_today_midnight()",
        "  - UPDATED: pc_load_state() error handler - line 1069 uses pc_get_today_midnight()",
        "  - UPDATED: Profile init in cron - line 4682 uses pc_get_today_midnight()",
        "  - UPDATED: pc_get_profile_usage() - line 5537 uses pc_get_today_midnight()",
        "  - UPDATED: pc_update_profile_usage() - line 5562 uses pc_get_today_midnight()",
        "BENEFIT 1: No more \"why isn't it resetting?\" support questions",
        "BENEFIT 2: Predictable reset behavior from day one",
        "BENEFIT 3: Easier to understand and debug",
        "BENEFIT 4: Aligns with user expectations",
        "TESTING: Verified on production system (192.168.1.1)",
        "TESTING: Manual fix applied successfully, now permanent in code",
        "VERSION: 1.4.16 â†’ 1.4.17"
      ]
    },
    {
      "version": "1.4.16",
      "date": "2026-01-06",
      "type": "hotfix",
      "changes": [
        "HOTFIX: Reverted inet46 (IPv4+IPv6) to inet (IPv4-only) due to rule errors",
        "BUG: Filter reload failing with 'rule expands to no valid combination'",
        "ERROR: IPv6 rule trying to use IPv4-only aliases and addresses",
        "SPECIFIC ERROR: pass log quick on { em1 } inet6 proto tcp from $parental_control_blocked to 192.168.1.251",
        "ROOT CAUSE: inet46 tells pfSense to create BOTH IPv4 and IPv6 rules",
        "ROOT CAUSE: parental_control_blocked alias contains only IPv4 addresses (MACs â†’ IPv4)",
        "ROOT CAUSE: Destination 192.168.1.251 is IPv4 address",
        "ROOT CAUSE: IPv6 rule with IPv4-only data = 'no valid combination'",
        "REALITY CHECK: User's network has NO IPv6 configured (grep inet6 /etc/pf.conf = 0)",
        "SOLUTION: Reverted ALL rules from 'inet46' back to 'inet' (IPv4-only)",
        "RESULT: Filter reload successful, no more rule errors",
        "RESULT: All 9 rules working correctly with IPv4",
        "LESSON: inet46 requires BOTH:",
        "  1. IPv6 enabled on network interfaces",
        "  2. Aliases configured with IPv6 addresses",
        "  3. Destination addresses supporting IPv6",
        "FUTURE: IPv6 support can be added when:",
        "  - User enables IPv6 on pfSense",
        "  - Aliases updated to support IPv6",
        "  - Conditional logic added (use inet46 only if IPv6 enabled)",
        "REVERTED RULES (8 locations):",
        "  - Block Page Access rule",
        "  - Device Block rule",
        "  - Generic Blocking rule",
        "  - Dynamic Blocking rule",
        "  - Service Block rules",
        "  - Service Monitor rules",
        "  - DNS Allow rule",
        "  - pfSense Access Allow rule",
        "MAINTAINED: direction 'any' and log 'yes' settings from v1.4.15",
        "VERSION: 1.4.15 â†’ 1.4.16"
      ]
    },
    {
      "version": "1.4.15",
      "date": "2026-01-06",
      "type": "enhancement",
      "changes": [
        "ENHANCEMENT: Standardized all firewall rules - IPv4+IPv6, Any Direction, Logging Enabled",
        "USER REQUIREMENT: All rules must have consistent configuration:",
        "  1. Address Family: IPv4 + IPv6 (inet46)",
        "  2. Direction: Any (both directions)",
        "  3. Logging: Enabled",
        "BEFORE: Mixed configuration across 8 rule creation locations:",
        "  - ipprotocol: 'inet' (IPv4 only) in ALL rules",
        "  - direction: 'any' in some, missing in others",
        "  - log: 'yes' in some, missing in others",
        "AFTER: Consistent configuration in ALL 8 rule locations:",
        "  âœ“ ipprotocol: 'inet46' (IPv4 + IPv6)",
        "  âœ“ direction: 'any' (both directions, where applicable)",
        "  âœ“ log: 'yes' (enabled for all rules)",
        "RULES UPDATED (8 locations):",
        "  1. Block Page Access rule (pc_create_block_rule)",
        "     - Added: ipprotocol 'inet46', log 'yes'",
        "  2. Device Block rule (pc_create_block_rule)",
        "     - Added: ipprotocol 'inet46', log 'yes'",
        "  3. Generic Blocking rule (pc_generate_blocking_rule)",
        "     - Changed: ipprotocol 'inet' â†’ 'inet46'",
        "  4. Dynamic Blocking rule (pc_create_blocking_rule)",
        "     - Changed: ipprotocol 'inet' â†’ 'inet46'",
        "     - Added: log 'yes'",
        "  5. Service Block rules (pc_create_service_monitoring_rules)",
        "     - Changed: ipprotocol 'inet' â†’ 'inet46'",
        "  6. Service Monitor rules (pc_create_service_monitoring_rules)",
        "     - Changed: ipprotocol 'inet' â†’ 'inet46'",
        "  7. DNS Allow rule (pc_create_allow_rules)",
        "     - Changed: ipprotocol 'inet' â†’ 'inet46'",
        "     - Added: log 'yes'",
        "  8. pfSense Access Allow rule (pc_create_allow_rules)",
        "     - Changed: ipprotocol 'inet' â†’ 'inet46'",
        "     - Added: log 'yes'",
        "BENEFITS:",
        "  âœ“ Consistent rule configuration across entire package",
        "  âœ“ IPv6-ready - supports dual-stack networks",
        "  âœ“ Complete visibility - all rules logged for debugging",
        "  âœ“ Simplified direction handling (no confusion about in/out)",
        "RESULT: Professional, maintainable firewall rule configuration",
        "VERSION: 1.4.14 â†’ 1.4.15"
      ]
    },
    {
      "version": "1.4.14",
      "date": "2026-01-06",
      "type": "bugfix",
      "changes": [
        "BUGFIX: Fixed firewall rule removal not working for dash-prefixed rules",
        "BUG: Dynamic Blocking rule still showed direction 'in' after v1.4.13 update",
        "USER REPORT: Rule direction not updating despite code changes deployed",
        "ROOT CAUSE: pc_remove_firewall_rules() only matched 'Parental Control:' (colon)",
        "ROOT CAUSE: Dynamic Blocking rule uses 'Parental Control -' (dash) in description",
        "ROOT CAUSE: Old rule with direction 'in' was never removed",
        "ROOT CAUSE: pc_create_blocking_rule() saw existing rule and skipped creation",
        "RESULT: Old rule persisted with direction 'in', new rule never created",
        "SOLUTION: Updated removal function to match both patterns:",
        "  - 'Parental Control:' (colon) - matches device-specific rules",
        "  - 'Parental Control -' (dash) - matches system rules",
        "TECHNICAL: Modified strpos() check to handle both description formats",
        "VERIFICATION: All 9 rules now show direction 'any':",
        "  âœ“ Allow pfSense Access for Blocked Devices",
        "  âœ“ Allow DNS for Blocked Devices",
        "  âœ“ Discord Service Block",
        "  âœ“ Discord Service Monitor",
        "  âœ“ YouTube Service Block",
        "  âœ“ YouTube Service Monitor",
        "  âœ“ Facebook Service Block",
        "  âœ“ Facebook Service Monitor",
        "  âœ“ Dynamic Blocking",
        "RESULT: Rule regeneration now works correctly",
        "RESULT: All rules use direction 'any' as intended",
        "VERSION: 1.4.13 â†’ 1.4.14"
      ]
    },
    {
      "version": "1.4.13",
      "date": "2026-01-06",
      "type": "enhancement",
      "changes": [
        "ENHANCEMENT: Simplified firewall rule direction to 'any' for all rules",
        "USER SUGGESTION: Why not use direction 'any' instead of 'in'/'out'?",
        "OBSERVATION: Two rules were 'inbound', rest should be 'outbound' - confusing!",
        "PROBLEM: Having to think about which rules need 'in' vs 'out' direction",
        "PROBLEM: Risk of getting direction wrong and rules not working",
        "SOLUTION: Changed ALL rules to use direction 'any' (both directions)",
        "BENEFIT 1: Simpler - no need to think about traffic direction",
        "BENEFIT 2: More reliable - catches traffic in both directions",
        "BENEFIT 3: Consistent - all rules behave the same way",
        "BENEFIT 4: Foolproof - eliminates direction-related bugs",
        "RULES UPDATED:",
        "  - Dynamic Blocking rule: 'in' â†’ 'any'",
        "  - Service Block rules: 'in' â†’ 'any'",
        "  - Service Monitor rules: 'in' â†’ 'any'",
        "  - DNS Allow rule: (no direction) â†’ 'any'",
        "  - pfSense Access rule: (no direction) â†’ 'any'",
        "RESULT: All floating rules now use direction 'any'",
        "RESULT: No more confusion about inbound vs outbound",
        "RESULT: Rules work correctly regardless of traffic direction",
        "TECHNICAL: Updated 5 rule creation functions in parental_control.inc",
        "VERSION: 1.4.12 â†’ 1.4.13"
      ]
    },
    {
      "version": "1.4.12",
      "date": "2026-01-06",
      "type": "hotfix",
      "changes": [
        "HOTFIX: Removed incorrect domain warning from URL verification",
        "BUG: v1.4.11 showed misleading warning about domain lists",
        "BUG: Warning claimed 'pfSense can ONLY load IPs, not domain names'",
        "USER REPORT: Discord domain list works perfectly, warning was wrong",
        "ROOT CAUSE: Incorrect understanding of pfSense URL alias behavior",
        "TRUTH: pfSense URL aliases AUTOMATICALLY resolve domains to IPs",
        "TRUTH: Both domain lists and IP lists work correctly in pfSense",
        "EVIDENCE: User's PC_Service_Discord alias populated with IPs from domain list",
        "SOLUTION: Removed misleading warning message",
        "SOLUTION: Kept domain detection for telemetry only (no user warnings)",
        "SOLUTION: Simplified content analysis (less aggressive)",
        "RESULT: Users can add domain lists without confusing warnings",
        "RESULT: Both IP lists and domain lists work correctly",
        "TECHNICAL:",
        "  - Removed domain_warning generation",
        "  - Removed warning display in verify_fetch action",
        "  - Updated telemetry to use domain_detected instead of domain_warning",
        "  - Simplified content detection (5 lines instead of 10)",
        "APOLOGY: v1.4.11 warning was based on incorrect assumptions",
        "LESSON: pfSense is smarter than assumed - resolves domains automatically",
        "VERSION: 1.4.11 â†’ 1.4.12"
      ]
    },
    {
      "version": "1.4.11",
      "date": "2026-01-06",
      "type": "critical_fix",
      "changes": [
        "CRITICAL FIX: Session-based URL storage for Online Services page",
        "BUG: URLs added via 'add_url' action were lost when clicking 'Verify' button",
        "BUG: User reported: 'Added Discord URL, clicked Verify, got error and URL disappeared'",
        "ROOT CAUSE: $services_config reloaded from config.xml on each POST request",
        "ROOT CAUSE: Session-based URLs (not saved to config) lost between requests",
        "ROOT CAUSE: verify_fetch action read from fresh config without session URLs",
        "SOLUTION 1: PHP Session Storage",
        "  - Added session_start() at top of parental_control_services.php",
        "  - Store temporary URLs in $_SESSION['pc_service_urls'][service_name]",
        "  - Merge session URLs with config URLs on every page load",
        "  - Session URLs persist across POST requests until alias created",
        "SOLUTION 2: URL Persistence Flow",
        "  - add_url: Store in $_SESSION + update in-memory $services_config",
        "  - verify_fetch: Read from merged (config + session) URLs",
        "  - create_alias: Save session URLs to config, then clear session",
        "  - delete_url: Remove from both session storage and in-memory config",
        "SOLUTION 3: Domain Detection & Warning System",
        "  - Enhanced pc_verify_service_urls() to download and analyze content",
        "  - Parse first 10 non-comment lines of each URL",
        "  - Detect if content contains domain names vs IP addresses",
        "  - Use regex to distinguish: IPs (\\d+\\.\\d+), Domains ([a-z0-9.-]+\\.com)",
        "  - Return domain_warning if domains detected",
        "  - Display prominent warning: 'pfSense can ONLY load IPs, not domains'",
        "  - Explain: Use DNS Resolver (Unbound) for domain-based blocking",
        "RESULT: URLs added via UI now persist until alias is created",
        "RESULT: Verify button works correctly with temporary URLs",
        "RESULT: Users warned when adding incompatible domain lists",
        "RESULT: Clear explanation prevents user confusion",
        "TECHNICAL CHANGES:",
        "  - parental_control_services.php: Added session_start()",
        "  - parental_control_services.php: Merge session URLs after config load",
        "  - parental_control_services.php: Updated add_url to use $_SESSION",
        "  - parental_control_services.php: Updated delete_url to clear session",
        "  - parental_control_services.php: Updated create_alias to save & clear session",
        "  - parental_control_services.php: Enhanced pc_verify_service_urls()",
        "  - parental_control_services.php: Updated verify_fetch to show warnings",
        "USER IMPACT:",
        "  âœ“ Online Services page now works as expected",
        "  âœ“ URLs don't disappear when clicking Verify",
        "  âœ“ Clear feedback about domain vs IP lists",
        "  âœ“ Prevents wasted time adding incompatible URLs",
        "VERSION: 1.4.10 â†’ 1.4.11"
      ]
    },
    {
      "version": "1.4.10",
      "date": "2026-01-05",
      "type": "hotfix",
      "changes": [
        "CRITICAL HOTFIX: Fixed usage tracking completely broken (returning 0 connections)",
        "BUG: pc_has_active_connections() returning 0 despite active internet connections",
        "BUG: Usage counter not incrementing even with heavy internet usage",
        "ROOT CAUSE: Regex failed to parse NAT state table entries",
        "ROOT CAUSE: pfSense state table shows each connection TWICE (with and without NAT)",
        "ROOT CAUSE: NAT format: '203.191.182.168:12345 (192.168.1.96:54321) -> 8.8.8.8:443'",
        "ROOT CAUSE: Old regex extracted WAN IP (203.191.182.168) instead of device IP (192.168.1.96)",
        "ROOT CAUSE: IP comparison failed: WAN IP !== device IP â†’ connection not counted",
        "SOLUTION: Updated regex to extract IP from inside parentheses for NAT entries",
        "SOLUTION: Added deduplication using unique connection keys (src:port->dst:port)",
        "SOLUTION: Each connection now counted only once despite appearing twice in state table",
        "RESULT: Usage tracking now works correctly",
        "RESULT: HISENSE TV with 100+ active connections now properly tracked",
        "UPDATED: parental_control.inc - Fixed pc_has_active_connections() parsing",
        "VERSION: 1.4.9 â†’ 1.4.10"
      ]
    },
    {
      "version": "1.4.9",
      "date": "2026-01-05",
      "type": "hotfix",
      "changes": [
        "HOTFIX: Fixed auto-update script directory mismatch",
        "BUG: Auto-update failing with 'directory does not exist' error",
        "BUG: cp: directory /usr/local/share/pfSense-pkg-parental_control does not exist",
        "ROOT CAUSE: Directory name mismatch between INSTALL.sh and auto-update script",
        "ROOT CAUSE: INSTALL.sh creates 'pfSense-pkg-KACI-Parental_Control' directory",
        "ROOT CAUSE: auto_update script tried to copy to 'pfSense-pkg-parental_control' (wrong name)",
        "SOLUTION: Fixed auto-update script to use correct directory name",
        "SOLUTION: Added mkdir -p to ensure directory exists before copying",
        "SOLUTION: Directory name now matches INSTALL.sh: pfSense-pkg-KACI-Parental_Control",
        "RESULT: Auto-update now works correctly",
        "RESULT: No more 'directory does not exist' errors",
        "UPDATED: auto_update_parental_control.sh - corrected directory name",
        "VERSION: 1.4.8 â†’ 1.4.9"
      ]
    },
    {
      "version": "1.4.8",
      "date": "2026-01-05",
      "type": "hotfix",
      "changes": [
        "HOTFIX: Fixed 'Offline' status for all devices after v1.4.7 update",
        "BUG: All devices showing as 'Offline' despite being on network",
        "BUG: Status page showed all devices with gray 'Offline' badge",
        "ROOT CAUSE: pc_is_device_online() was checking 'connection_count' from state file",
        "ROOT CAUSE: v1.4.7 changed to 'internet_connections' (only public IPs)",
        "ROOT CAUSE: Devices with only local traffic had 0 internet_connections",
        "ROOT CAUSE: Function incorrectly returned false for devices on network but not using internet",
        "CONFUSION: Online status vs Internet usage are TWO DIFFERENT THINGS",
        "  - Online status = Device is on the network (ARP table)",
        "  - Internet usage = Device is actively using external internet (state table + public IPs)",
        "SOLUTION: Changed pc_is_device_online() to use ARP table as PRIMARY check",
        "SOLUTION: Removed state file connection count check (was causing false negatives)",
        "SOLUTION: ARP table is now source of truth for 'Is device on network?'",
        "SOLUTION: internet_connections is ONLY used for usage tracking, not status",
        "RESULT: Devices on network now correctly show as 'Online'",
        "RESULT: Usage tracking still only counts external internet (v1.4.7 fix preserved)",
        "RESULT: Status badge works correctly: Online (green) / Offline (gray)",
        "ARCHITECTURE: Separated concerns - network presence vs internet usage",
        "UPDATED: pc_is_device_online() - ARP table is now primary check",
        "VERSION: 1.4.7 â†’ 1.4.8"
      ]
    },
    {
      "version": "1.4.7",
      "date": "2026-01-05",
      "type": "critical_fix",
      "changes": [
        "CRITICAL FIX: Usage tracking now only counts EXTERNAL INTERNET traffic",
        "BUG: Devices counted as 'online' even when only doing local LAN traffic",
        "BUG: Basement TV showing 40 mins usage despite no internet communication",
        "BUG: Device at 192.168.1.30 showing 35 mins usage with zero internet activity",
        "ROOT CAUSE: pc_has_active_connections() counted ALL ESTABLISHED connections",
        "ROOT CAUSE: Local traffic (192.168.x.x â†’ 192.168.x.x) counted as 'internet usage'",
        "ROOT CAUSE: Broadcast/multicast (255.255.255.255, 224.x.x.x) counted as usage",
        "ROOT CAUSE: Link-local traffic (169.254.x.x) counted as usage",
        "EXAMPLES OF INCORRECTLY COUNTED TRAFFIC:",
        "  - Device talking to local NAS/printer (192.168.1.100 â†’ 192.168.1.50)",
        "  - DHCP broadcasts (â†’ 255.255.255.255)",
        "  - mDNS/SSDP discovery (â†’ 224.0.0.251)",
        "  - Local Plex streaming (â†’ 192.168.1.100)",
        "SOLUTION: Added pc_is_private_ip() function to detect RFC 1918 private IPs",
        "SOLUTION: Parse state table lines to extract source and destination IPs",
        "SOLUTION: Only count connections where destination is a PUBLIC IP",
        "SOLUTION: Support IPv4 private ranges (10.x, 172.16-31.x, 192.168.x)",
        "SOLUTION: Support IPv6 private ranges (fc00::/7, fe80::/10)",
        "SOLUTION: Filter out loopback (127.x), link-local (169.254.x), multicast (224-239.x)",
        "RESULT: Usage tracking now accurately reflects REAL internet usage",
        "RESULT: Local LAN traffic no longer increments usage counters",
        "RESULT: Devices idle on internet but active on LAN show 0 usage",
        "RESULT: More accurate time limit enforcement",
        "NEW FUNCTION: pc_is_private_ip() - Detects private/local IP addresses",
        "UPDATED: pc_has_active_connections() - Parses state table and filters by destination",
        "UPDATED: Logging messages now say 'internet connections' instead of 'connections'",
        "UPDATED: State file now stores 'internet_connections' count separately",
        "VERSION: 1.4.6 â†’ 1.4.7"
      ]
    },
    {
      "version": "1.4.6",
      "date": "2026-01-05",
      "type": "critical_bugfix",
      "changes": [
        "CRITICAL FIX: Temp file creation verification added",
        "BUG: file_put_contents() returns success but file doesn't exist on disk",
        "BUG: Diagnostics showed temp_file_exists:false despite successful write",
        "ROOT CAUSE: Disk full, quota exceeded, or write cache not flushed",
        "ROOT CAUSE: file_put_contents() doesn't verify file actually created",
        "SOLUTION: Added disk space check before write (2x file size required)",
        "SOLUTION: Added clearstatcache() to get fresh file info",
        "SOLUTION: Verify temp file exists after write with file_exists()",
        "SOLUTION: Verify file size matches bytes written",
        "SOLUTION: Clean up partial files if size mismatch detected",
        "RESULT: Temp file creation failures now caught immediately",
        "RESULT: Clear error messages about disk space or filesystem issues",
        "RESULT: No more 'temp_file_exists:false' errors",
        "ENHANCEMENT: Auto-update script now logs to syslog",
        "ENHANCEMENT: Better 'no update needed' message in syslog",
        "ENHANCEMENT: Auto-update shows version numbers in log messages",
        "Updated pc_save_state() with disk space and file verification",
        "Updated auto_update_parental_control.sh with syslog logging",
        "VERSION: 1.4.5 â†’ 1.4.6"
      ]
    },
    {
      "version": "0.4.0",
      "date": "2026-01-03",
      "type": "critical_bugfix",
      "changes": [
        "CRITICAL FIX: State file rename() failure resolved with fallback mechanism",
        "BUG: Cron job failing with 'No such file or directory' during rename()",
        "BUG: Error shows 'existing file perms: 0644' but rename still fails",
        "ROOT CAUSE: FreeBSD rename() can fail across filesystems or with directory permissions",
        "ROOT CAUSE: Atomic rename() operation not supported in all scenarios",
        "SOLUTION: Added intelligent fallback - try rename() first, then copy()+unlink()",
        "SOLUTION: Suppressed rename() error with @ to allow fallback to execute",
        "SOLUTION: Added comprehensive diagnostics (file existence, permissions, sizes)",
        "SOLUTION: Enhanced logging for fallback method usage",
        "RESULT: State file saves succeed even when rename() fails",
        "RESULT: Cron job runs without errors",
        "RESULT: Usage tracking works reliably",
        "RESULT: Better error diagnostics for troubleshooting",
        "Updated pc_save_state() with copy+unlink fallback mechanism",
        "Added detailed diagnostic information in error messages",
        "VERSION: 1.4.4 â†’ 1.4.5"
      ]
    },
    {
      "version": "0.3.9",
      "date": "2026-01-02",
      "type": "critical_bugfix",
      "changes": [
        "CRITICAL FIX: Schedule blocking now works correctly for overnight time ranges",
        "BUG: Schedules like '20:30 - 7:30' showed as Inactive when should be Active",
        "ROOT CAUSE: String comparison '20:30' < '7:30' returned TRUE (wrong!)",
        "ROOT CAUSE: Function incorrectly treated overnight range as normal range",
        "ROOT CAUSE: Used AND logic instead of OR logic for overnight spans",
        "SOLUTION: Added time normalization with zero-padding (7:30 â†’ 07:30)",
        "SOLUTION: String comparison now works correctly: '20:30' < '07:30' = FALSE",
        "RESULT: Overnight schedules now properly detected and enforced",
        "RESULT: Status page shows 'BLOCKING NOW' when schedule is active",
        "RESULT: Devices blocked correctly during bedtime hours",
        "CRITICAL FIX: State file write failures resolved",
        "BUG: Cron job failed every 5 minutes with 'Failed to rename temporary state file'",
        "ROOT CAUSE: /var/db directory permission or existence issues",
        "SOLUTION: Added directory existence check and creation",
        "SOLUTION: Enhanced error reporting with permission details",
        "RESULT: State file writes succeed, cron job runs without errors",
        "Updated pc_is_time_in_range() with time normalization",
        "Updated pc_save_state() with directory checks and better error messages",
        "VERSION: 1.4.3 â†’ 1.4.4"
      ]
    },
    {
      "version": "0.3.8",
      "date": "2026-01-02",
      "type": "critical_bugfix",
      "changes": [
        "CRITICAL FIX: Resolved firewall boot hang issue ('Loading KACI Parental Control' freeze)",
        "ROOT CAUSE: parental_control_sync() called pc_ensure_captive_portal_running() during boot",
        "ROOT CAUSE: Blocking exec() call waited for RC script (2+ seconds with sleep + verification)",
        "ROOT CAUSE: Boot process hung waiting for captive portal server startup to complete",
        "SOLUTION: Created pc_ensure_captive_portal_running_async() for non-blocking startup",
        "SOLUTION: Changed boot sync to use async version (nohup + background execution)",
        "SOLUTION: Captive portal now starts in background without blocking boot process",
        "RESULT: Firewall boots normally and quickly returns to 'Enter an Option:' prompt",
        "RESULT: No more boot hangs or freezes during startup",
        "RESULT: Cron job verifies/restarts captive portal if needed after boot completes",
        "Updated parental_control.inc: Added async captive portal startup function",
        "Updated parental_control.inc: Boot sync now uses non-blocking call",
        "Updated VERSION to 1.4.3 for this critical fix"
      ]
    },
    {
      "version": "0.3.7",
      "date": "2026-01-01",
      "type": "enhancement",
      "changes": [
        "Documentation: Removed redundant ROUTER_IMPLEMENTATION.md",
        "Documentation: Consolidated router logic into TECHNICAL_REFERENCE.md",
        "Documentation: Added Multi-File Router Capability section",
        "Documentation: Final cleanup - 6 core docs remaining"
      ]
    },
    {
      "version": "0.3.6",
      "date": "2026-01-01",
      "type": "enhancement",
      "changes": [
        "INSTALL.sh: Added automatic dependency checking for sudo and cron",
        "INSTALL.sh: Offers to auto-install missing dependencies",
        "INSTALL.sh: Prevents installation if dependencies cannot be satisfied",
        "Documentation: Added dependency information to README.md and GETTING_STARTED.md",
        "BUILD_INFO.json: Added dependencies section with package requirements"
      ]
    },
    {
      "version": "0.3.5",
      "date": "2026-01-01",
      "type": "enhancement",
      "changes": [
        "CONSOLIDATION: Reduced shell scripts from 8 to 6 (5 core + 1 dev tool)",
        "parental_control_analyzer.sh: Added 'reset' command (consolidated from diagnose_reset.sh)",
        "parental_control_analyzer.sh: Added 'verify' command (consolidated from verify_files.sh)",
        "Removed diagnose_reset.sh - functionality now in analyzer",
        "Removed verify_files.sh - functionality now in analyzer",
        "bump_version.sh: Enhanced with built-in INSTALL/UNINSTALL sync validation function",
        "bump_version.sh: Validates synchronization before every release automatically",
        "Removed validate_cleanup.sh - functionality integrated into bump_version.sh",
        "parental_control_captive.sh: Now properly deployed by INSTALL.sh as RC script",
        "INSTALL.sh: Updated to deploy captive.sh to /usr/local/etc/rc.d/",
        "UNINSTALL.sh: Updated cleanup to match new structure",
        "Documentation: Consolidated all docs into existing files (TECHNICAL_REFERENCE, USER_GUIDE)",
        "Documentation: Removed historical docs (SOLUTION_PLAN_v1.1.8, REVERT_TO_v1.1.9, CRITICAL_FIX_v1.1.4)",
        "Documentation: Only 7 essential .md files remain in docs/ folder",
        "Documentation: All historical notes preserved in TECHNICAL_REFERENCE.md",
        "Automated validation ensures no leftover files after uninstall"
      ]
    },
    {
      "version": "0.3.4",
      "date": "2026-01-01",
      "type": "bugfix",
      "changes": [
        "CRITICAL FIX: Resolved 'Unresolvable destination port alias' error in firewall rules",
        "Created automatic port alias creation system for pfSense firewall rules",
        "Added KACI_PC_Ports alias (80, 443, 1008) for pfSense access rule",
        "Added KACI_PC_Web alias (80, 443) for moderate enforcement mode",
        "Implemented pc_create_port_aliases() function to auto-create port aliases",
        "Updated 'Allow pfSense Access for Blocked Devices' rule to use port alias",
        "Updated moderate enforcement mode block rule to use port alias",
        "Fixes 'Rule skipped' errors that prevented blocked devices from accessing block page",
        "Port aliases are now created automatically during package sync/install",
        "No manual configuration required - aliases created transparently",
        "INSTALL.sh: Added auto_update_parental_control.sh to verification checks",
        "INSTALL.sh: Enhanced file upload verification with detailed status output",
        "INSTALL.sh: Added check for auto-update script existence before enabling cron",
        "INSTALL.sh: Added new documentation files to deployment (FIX_PORT_ALIAS_ERROR_v1.4.1.md, GETTING_STARTED.md)",
        "INSTALL.sh: Improved error messages for auto-update setup failures",
        "UNINSTALL.sh: Now removes port aliases KACI_PC_Ports and KACI_PC_Web",
        "UNINSTALL.sh: Complete cleanup of all parental control traces",
        "Created verify_files.sh: Standalone verification script for troubleshooting installations",
        "verify_files.sh: Checks all files, permissions, configs, aliases, rules, and cron jobs",
        "verify_files.sh: Color-coded output for easy visual verification"
      ]
    },
    {
      "version": "0.3.3",
      "date": "2025-12-27",
      "type": "feature",
      "changes": [
        "MAJOR: Added user-friendly block page (parental_control_blocked.php)",
        "Block page shows why user is blocked (time limit/schedule)",
        "Displays usage stats, profile info, and next reset time",
        "Parent override feature with password authentication",
        "Temporary access grants (configurable duration, default 30 min)",
        "Countdown timer for active overrides",
        "Beautiful gradient UI with animations",
        "Auto-refresh when override expires",
        "Firewall rules updated to allow access to block page",
        "Added pc_has_active_override() function",
        "Override state tracking in state.json",
        "Detailed logging of override attempts (success/failure)",
        "Updated INSTALL.sh to deploy block page",
        "Changed block rules from 'block' to 'reject' for better UX"
      ]
    },
    {
      "version": "0.3.2",
      "date": "2025-12-27",
      "type": "bugfix",
      "changes": [
        "CRITICAL: Fixed daily counter reset not working",
        "Bug: pc_reset_daily_counters() was resetting $state['devices'] (MAC-based)",
        "System now tracks by IP in $state['devices_by_ip'] (Layer 3)",
        "Reset function now resets BOTH arrays for backward compatibility",
        "Added detailed logging for reset operations",
        "Counters will now properly reset at midnight (or configured time)"
      ]
    },
    {
      "version": "0.3.1",
      "date": "2025-12-26",
      "type": "hotfix",
      "changes": [
        "CRITICAL: Fixed XML syntax error in parental_control_schedules.xml",
        "Wrapped PHP code in CDATA sections to prevent XML parsing errors",
        "Fixed XML_ERR_NAME_REQUIRED error at line 107",
        "Changed escaped HTML entities to literal in CDATA sections",
        "Schedules page now loads correctly without errors"
      ]
    },
    {
      "version": "0.3.0",
      "date": "2025-12-26",
      "type": "feature",
      "changes": [
        "Added dynamic profile dropdown for schedule creation - profiles auto-populate from configured profiles",
        "Multi-profile support - single schedule can now apply to multiple child profiles simultaneously",
        "Added 'Manage Profiles' link in schedule form for easy navigation",
        "Updated enforcement logic to handle schedules assigned to multiple profiles",
        "Backward compatibility maintained for existing schedules with single profile",
        "Profile dropdown shows message if no profiles configured",
        "Status page now displays all profiles a schedule applies to",
        "API: Added GET /api/schedules - List all configured schedules",
        "API: Added GET /api/schedules/{id} - Get schedule details by ID",
        "API: Added GET /api/schedules/active - Get currently active blocking schedules",
        "API: Added GET /api/profiles/{id}/schedules - Get schedules for a specific profile",
        "API: Updated GET /api/devices/{mac} - Now includes schedules_applied and currently_blocked",
        "API: Updated GET /api/profiles/{id} - Now includes schedules_applied array",
        "API: All schedule endpoints support multi-profile schedules",
        "API: Real-time active status calculation for all schedules"
      ]
    },
    {
      "version": "0.2.9",
      "date": "2025-12-26",
      "type": "update",
      "changes": [
        "Fixed schedule list view to display profile, days, time range, and enabled status",
        "Fixed Active Schedules section on status page to read from new KACI-PC-Schedule config",
        "Updated schedule enforcement logic to use new schedule system",
        "Schedules now show real-time active/inactive status with 'BLOCKING NOW' badge",
        "Maintains backward compatibility with legacy bedtime/school fields"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-26",
      "type": "update",
      "changes": [
        "Fixed AQM flowset busy errors - reduced cron frequency and removed excessive filter reloads"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-26",
      "type": "update",
      "changes": [
        "CRITICAL: Fixed data loss issue when editing profiles"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-26",
      "type": "update",
      "changes": [
        "Separated schedules into dedicated KACI-PC-Schedule tab - fixes +Add button conflict"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-26",
      "type": "update",
      "changes": [
        "Fixed +Add button adding schedule fields instead of device fields"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-26",
      "type": "bugfix",
      "changes": [
        "BUGFIX: Fixed +Add button in Profiles page not adding device rows",
        "BUGFIX: Replaced generic click handler with MutationObserver",
        "BUGFIX: Changed rowhelper fieldname from 'devices' to 'row' (pfSense convention)",
        "RESULT: +Add button now properly adds new device entry rows"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-26",
      "type": "critical",
      "changes": [
        "CRITICAL: Fixed config.xml corruption that caused backup restore every minute",
        "CRITICAL: Removed duplicate 'devices' key alongside 'row' that invalidated XML",
        "CRITICAL: Fixed device selection in Profiles page (JavaScript value mismatch)",
        "FEATURE: Added IP Address column to Status page showing tracked device IPs",
        "FEATURE: Days field now multi-select dropdown (Sunday-Saturday)",
        "FEATURE: Added time format examples (24-hour: 08:00=8am, 22:00=10pm)",
        "BUGFIX: Validation no longer modifies $post array preventing corruption",
        "BUGFIX: pc_process_profile_devices() no longer adds duplicate keys",
        "BUGFIX: Cleaned empty device entries from existing profiles",
        "RESULT: Profiles page fully functional - can add/edit devices without errors",
        "RESULT: Configuration persists correctly without backup restores",
        "RESULT: Device dropdown auto-populates all fields correctly"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-26",
      "type": "hotfix",
      "changes": [
        "CRITICAL BUGFIX: pc_get_devices() now correctly extracts devices from nested profiles",
        "CRITICAL BUGFIX: Added missing 'enable' key to devices so tracking logic works",
        "CRITICAL BUGFIX: Normalize 'row' to 'devices' for pfSense rowhelper XML compatibility",
        "RESULT: Usage tracking now works correctly - time counters increment properly",
        "RESULT: State file now populates with device data as expected",
        "RESULT: GUI now displays accurate usage and remaining time",
        "TESTED: All fixes verified on production system (fw.keekar.com)",
        "ARCHITECTURE: Devices are now correctly extracted from profile hierarchy",
        "RELIABILITY: Profile 'enable' status properly propagates to devices"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-26",
      "type": "major",
      "changes": [
        "CRITICAL FIX: Real connection tracking using pfctl state table",
        "CRITICAL FIX: Now tracks ACTUAL internet usage (not just network presence)",
        "CRITICAL FIX: Devices with no active connections don't increment usage",
        "NEW: PID lock mechanism prevents concurrent cron executions",
        "NEW: IP address lookup from MAC address with caching",
        "NEW: Log analyzer tool (parental_control_analyzer.sh)",
        "NEW: Real-time log monitoring with colored output",
        "NEW: Device-specific activity queries",
        "NEW: System status checking (service, logs, state, cron)",
        "IMPROVED: Proper interval calculation (matches cron schedule)",
        "IMPROVED: Enhanced logging with connection counts",
        "IMPROVED: Execution time tracking in cron job",
        "PERFORMANCE: Connection tracking uses timeout (2 seconds)",
        "PERFORMANCE: IP lookup caching within execution",
        "RELIABILITY: Graceful degradation if state table query fails",
        "ARCHITECTURE: State file path changed to .jsonl (JSONL format)",
        "DIAGNOSTICS: Connection count stored in state file",
        "BASED ON: MultiServiceLimiter proven implementation"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-26",
      "type": "hotfix",
      "changes": [
        "CRITICAL BUGFIX: Fixed logging not working by default (opt-out vs opt-in)",
        "BUGFIX: Auto-create log directory (/var/log/) if missing",
        "BUGFIX: Auto-create state directory (/var/db/) if missing",
        "BUGFIX: Added graceful error handling with syslog fallback",
        "BUGFIX: Enhanced cron job setup with permission fix",
        "NEW: Added diagnostic tool (parental_control_diagnostic.php)",
        "NEW: Added TROUBLESHOOTING_USAGE_AND_LOGS.md guide",
        "DOCS: Updated INSTALL.sh to include all new files and directories",
        "DOCS: Added Quick Fix Guide in hotfix summary"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-25",
      "type": "major",
      "changes": [
        "CRITICAL BUGFIX: Fixed PHP parse error in JSDoc (cron syntax */1)",
        "DRY refactoring: Added 10+ reusable helper functions",
        "Performance: Implemented caching system for expensive operations",
        "Performance: Caching for DHCP leases, ARP lookups, config reads, state file",
        "Performance: Automatic cache invalidation on data changes",
        "API: Full RESTful API with authentication (parental_control_api.php)",
        "API: Endpoints for devices, profiles, usage, status, override, block/unblock",
        "API: API key authentication via X-API-Key header or query parameter",
        "API: CORS support for external dashboards and mobile apps",
        "API: Comprehensive documentation in docs/API.md",
        "Helpers: pc_normalize_mac, pc_validate_mac, pc_validate_time",
        "Helpers: pc_validate_numeric_range, pc_is_mac_unique",
        "Helpers: pc_is_service_enabled, pc_is_device_enabled",
        "Helpers: pc_get_devices, pc_get_profiles, pc_get_cached, pc_clear_cache",
        "Code Quality: Eliminated code duplication across 20+ locations",
        "Maintainability: Centralized validation and config access logic"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-25",
      "type": "minor",
      "changes": [
        "Added health check endpoint for monitoring",
        "Implemented automatic log rotation (5MB per file, keep 10)",
        "Enhanced JSDoc documentation for all functions",
        "Created configuration example files",
        "Implemented graceful degradation patterns",
        "Added try-catch blocks to critical functions",
        "Improved inline comments explaining 'why' not 'what'",
        "Created Quick Start guide",
        "DRY refactoring - extracted reusable functions",
        "Performance optimizations (caching, batching)",
        "Added environment variable support",
        "Enhanced console logging with emojis",
        "Added BUILD_INFO.json tracking"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-24",
      "changes": [
        "Version sync across all files",
        "Minor bug fixes"
      ]
    },
    {
      "version": "0.2.8",
      "date": "2025-12-24",
      "changes": [
        "Backend parsing of device_selector dropdown",
        "Profile-based device management",
        "OpenTelemetry logging implementation",
        "Initial release"
      ]
    }
  ],
  "_metadata": {
    "generated": "2025-12-25T00:00:00Z",
    "generator": "KACI-Parental_Control Build System",
    "format_version": "1.0"
  }
}
